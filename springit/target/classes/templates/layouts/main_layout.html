<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head th:fragment="head(title)">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="EDILLZA, e-learning website">
        <meta name="author" content="Nael Saleh, Omar Salameh">
        <title th:text="${title}">EDZILLA</title>
        <!-- Bootstrap core CSS and JS-->
        <link rel="stylesheet" th:href="@{/libs/bootstrap/css/bootstrap.min.css}"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script type="text/javascript" th:src="@{/libs/bootstrap/js/bootstrap.bundle.min.js}"></script>
        <script type="text/javascript" th:src="@{/libs/bootstrap/js/bootstrap.min.js}"></script>
        <!-- Custom styles for this template -->
        <link rel="stylesheet" th:href="@{/css/reset.css}">
        <link rel="stylesheet" th:href="@{/css/springit.css}">
        <link rel="stylesheet" th:href="@{/css/navbar.css}">
        <link rel="stylesheet" th:href="@{/css/register.css}">
        <!-- Google Fonts -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald|Roboto" >
        <!-- Font Awesome (for icons) -->
        <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
    </head>
    <body>
        <!-- ON : Navigation -->
        <nav class="navbar navbar-expand-md sticky-top" th:fragment="navigation">
            <div class="container">
                <!-- Site Logo -->
                <a class="navbar-brand" href="/">
                    <i class="fas fa-graduation-cap"></i>
                    EDZILLA
                </a>
                <!-- Toggler button -->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>
                <!-- Navbar Content -->
                <div class="collapse navbar-collapse" id="navbarSupportedContent" role="full-horizontal">
                    <ul class="navbar-nav ml-auto">
                        <!-- if user is signed in -->
                        <li class="nav-item" sec:authorize="hasRole('ROLE_USER')">
                            <a class="nav-course" th:href="@{/course/submit}">
                                <i class="fas fa-plus"></i> New Course
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="isAuthenticated()">
                            <a class="nav-course" th:href="@{/profile}">
                                <i class="fas fa-user-circle"></i> Account
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="hasRole('ROLE_ADMIN')">
                            <a class="nav-course" th:href="@{/course/reportAdmin}">
                                <i class="fas fa-bug"></i> Reported Course
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="isAuthenticated()">
                            <form method="POST" th:action="@{/logout}" sec:authorize="isAuthenticated()">
                                <button  class="nav-course">
                                    <i class="fa fa-sign-out-alt" aria-hidden="true"></i> Sign Out
                                </button>
                            </form>
                        </li>

                        <!-- if user is not signed in -->
                        <li class="nav-item" sec:authorize="!isAuthenticated()">
                            <a class="nav-course" th:href="@{/login}">
                                <i class="fa fa-sign-in-alt" aria-hidden="true"></i> LogIn
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="!isAuthenticated()">
                            <a class="nav-course" th:href="@{/register}">
                                <i class="fa fa-user-plus" aria-hidden="true"></i> Register
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- ON : Jumbotron -->
        <div class="jumbotron jumbotron-fluid" th:fragment="jumbotron">
            <div class="container" align="center">
                <h2 class="display-4">WELCOME TO <abbr title="Education Zilla">EDZILLA</abbr></h2>
                <p class="lead">Due to the current situation (COVID-19), EDZILLA was born to facilitate the process of
                    learning and simplify it. EDZILLA also cares about users' feedback to improve the quality of services,
                    by providing rating and commenting features in published courses.</p>
            </div>
        </div>

        <div class="container" th:fragment="content">
            <p>This is your main content</p>
        </div>

        <!-- ON : Navigation -->
        <nav class="navbar navbar-expand-md sticky-top" th:fragment="home-navigation">
            <div class="container-fluid">
                <!-- Site Logo -->
                <a class="navbar-brand" href="/">
                    <i class="fas fa-graduation-cap"></i>
                    EDZILLA
                </a>

                <!-- search -->
                <div class="search-course">
                    <input id="search-input" autofocus type="search" placeholder="Enter Course Title" class="form-control">
                    <div id="search-result"></div>
                </div>

                <!-- Toggler button -->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContents"
                        aria-controls="navbarSupportedContents" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>
                <!-- Navbar Content -->
                <div class="collapse navbar-collapse" id="navbarSupportedContents" role="full-horizontal">
                    <ul class="navbar-nav ml-auto">
                        <!-- if user is signed in -->
                        <li class="nav-item" sec:authorize="hasRole('ROLE_USER')">
                            <a class="nav-course" th:href="@{/course/submit}">
                                <i class="fas fa-plus"></i> New Course
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="isAuthenticated()">
                            <a class="nav-course" th:href="@{/profile}">
                                <i class="fas fa-user-circle"></i> Account
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="hasRole('ROLE_ADMIN')">
                            <a class="nav-course" th:href="@{/course/reportAdmin}">
                                <i class="fas fa-bug"></i> Reported Course
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="isAuthenticated()">
                            <form method="POST" th:action="@{/logout}" sec:authorize="isAuthenticated()">
                                <button  class="nav-course">
                                    <i class="fa fa-sign-out-alt" aria-hidden="true"></i> Sign Out
                                </button>
                            </form>
                        </li>

                        <!-- if user is not signed in -->
                        <li class="nav-item" sec:authorize="!isAuthenticated()">
                            <a class="nav-course" th:href="@{/login}">
                                <i class="fa fa-sign-in-alt" aria-hidden="true"></i> LogIn
                            </a>
                        </li>
                        <li class="nav-item" sec:authorize="!isAuthenticated()">
                            <a class="nav-course" th:href="@{/register}">
                                <i class="fa fa-user-plus" aria-hidden="true"></i> Register
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <script>
                function get_courses(str) {
                      "use strict";
                      var search_result = document.getElementById('search-result');
                      if (str.length==0) {
                        document.getElementById("search-result").textContent="";
                        document.getElementById("search-result").style.border="0px";
                        document.getElementById("search-result").style.display='none';
                        return;
                      }
                      document.getElementById("search-result").style.display='block';
                      fetch(`http://localhost:8080/course/search/${str}`)
                                          .then(response => response.json())
                                          .then(coursesList =>{
                                                    coursesList.forEach( (course ) => {
                                                          var a = document.createElement('a');
                                                          var hr = document.createElement('hr');
                                                          var linkText = document.createTextNode(course.title);
                                                          a.appendChild(linkText);
                                                          a.title = course.description;
                                                          a.href = "http://localhost:8080/course/"+ course.id;
                                                          search_result.appendChild(a);
                                                          search_result.appendChild(hr);
                                                    } )
                                           })
                                          .catch(err => console.error(err));
                    }
                    // ------------------------------------------------------------------------
                    var s = document.getElementById("search-input");
                    s.addEventListener("keyup" , function() {
                      document.getElementById("search-result").innerHTML='';
                      get_courses(s.value);
                    });
                     s.addEventListener("search" , function() {
                      document.getElementById("search-result").innerHTML='';
                      get_courses(s.value);
                    });
            </script>
        </nav>
    </body>
</html>